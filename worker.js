// src/worker.ts
chrome.runtime.onInstalled.addListener(() => {
  chrome.storage.sync.set({
    fetchOnHover: false,
    requireCntrl: false
  });
});
function parseValue(usd) {
  if (!usd)
    return 0;
  return Number(usd.replace(/\$|,/g, ""));
}
function cutStr(str, startIdx, from, fromExpand, to, defaultValue, regex, format) {
  try {
    let idx = str.indexOf(from, startIdx);
    if (idx === -1)
      throw -1;
    idx += from.length;
    if (fromExpand) {
      const endIdx = str.indexOf(fromExpand, idx);
      if (endIdx === -1)
        throw -1;
      idx = endIdx + fromExpand.length;
    }
    const toIdx = str.indexOf(to, idx);
    const cut = str.substring(idx, toIdx);
    const cleaned = regex ? cut.replace(regex, "") : cut;
    const result = format ? format(cleaned) : cleaned;
    return [result, toIdx];
  } catch {
    return [defaultValue, startIdx];
  }
}
var ENS_MAP = {};
async function resolveEnsName(id) {
  const cached = ENS_MAP[id];
  if (cached)
    return await Promise.resolve(cached);
  const loopup = new Promise(async (r) => {
    const res = await fetch("https://etherscan.io/enslookup-search?search=" + id);
    const ethscan = await res.text();
    const [address] = cutStr(ethscan, 100, `='txtEthereumAddress`, ">", "</span>", null);
    if (address) {
      ENS_MAP[address] = id;
      ENS_MAP[id] = address;
      r(address);
    } else {
      r(null);
    }
  });
  ENS_MAP[id] = loopup;
  return await loopup;
}
var CACHE = {};
async function fetchAddress(message, sendResponse) {
  let address;
  let ensName;
  let addressOrEns = message.id.toLowerCase();
  const cached = CACHE[addressOrEns];
  if (cached) {
    const response = await Promise.resolve(cached);
    sendResponse(response);
    return;
  }
  if (addressOrEns.startsWith("0x")) {
    address = addressOrEns;
    ensName = await Promise.resolve(ENS_MAP[address]);
  } else {
    const resolved = await resolveEnsName(addressOrEns);
    if (resolved) {
      address = resolved;
      ensName = addressOrEns;
    } else {
      sendResponse({
        type: "ADDRESS_RESPONSE",
        address,
        ens: addressOrEns,
        failed: true
      });
    }
  }
  try {
    const r = await fetch("https://etherscan.io/address/" + address);
    let ethscan = await r.text();
    let [tag] = cutStr(ethscan, 0, "og:title", `="`, "Address", "");
    if (tag)
      tag = tag.substring(0, tag.length - 3);
    ethscan = ethscan.substring(ethscan.indexOf("col-md-8") - 2);
    const [ether, ethIdx] = cutStr(ethscan, 0, "col-md-8", ">", "</div>", 0, /\sEther|<b>|<\/b>|,/g, parseValue);
    const [etherValue, ethVIdx] = cutStr(ethscan, ethIdx, "col-md-8", ">", "<span", 0, /\s|\$|,/g, parseValue);
    const [allTokensValue, atvIdx] = cutStr(ethscan, ethVIdx, "availableBalanceDropdown", ">", "<span", 0, />|\s|\$|,/g, parseValue);
    ethscan = ethscan.substring(atvIdx);
    let lastTokenIdx = ethscan.indexOf("list-custom-ERC20");
    let tokens = [];
    let moreTokens = lastTokenIdx >= 0;
    while (moreTokens) {
      const [img, imgIdx] = cutStr(ethscan, lastTokenIdx, "list-custom-ERC20", `<img src='`, `'`, null);
      if (img === null)
        break;
      const [amount, amtIdx] = cutStr(ethscan, imgIdx, `class='list-amount`, ">", " ", 0, void 0, parseValue);
      const [symbol, symIdx] = cutStr(ethscan, amtIdx, " ", null, "</span>", null);
      const [value, valIdx] = cutStr(ethscan, symIdx, "<span", ">", "</span>", 0, void 0, (s) => parseValue(s) || 0);
      tokens.push({ symbol, img, amount, value });
      lastTokenIdx = valIdx;
    }
    const tokenCount = tokens.length;
    tokens = tokens.sort((a, b) => a.value - b.value).slice(-3).reverse();
    tokens.forEach((t) => t.img = "https://etherscan.io" + t.img);
    const tokenValue = tokens.reduce((p, c) => p + c.value, 0);
    if (!ensName) {
      const [parsedEns] = cutStr(ethscan, Math.max(lastTokenIdx, 1), `id='ensName'`, "> ", "</a>", null, /\s/g);
      if (parsedEns)
        ensName = parsedEns;
    }
    const response = {
      type: "ADDRESS_RESPONSE",
      address,
      ens: ensName,
      tag,
      ether,
      etherValue,
      tokens,
      tokenCount,
      tokensValue: allTokensValue,
      remainingTokensValue: allTokensValue > tokenValue ? allTokensValue - tokenValue : void 0
    };
    CACHE[address] = response;
    CACHE[ensName] = response;
    sendResponse(response);
  } catch (ex) {
    console.error(ex);
    sendResponse({
      type: "ADDRESS_RESPONSE",
      address,
      ens: ensName,
      failed: true
    });
  }
}
chrome.runtime.onMessage.addListener((message, _, sendResponse) => {
  switch (message.type) {
    case "ENS_RESOLVE":
      resolveEnsName(message.id).then((address) => {
        if (address) {
          sendResponse({ type: "ENS_RESPONSE", address });
        } else {
          sendResponse({ type: "ENS_RESPONSE", failed: true });
        }
      });
      return true;
    case "ADDRESS_REQUEST":
      fetchAddress(message, sendResponse);
      return true;
  }
  return false;
});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL3dvcmtlci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLy8gaW1wb3J0IEVOUyBmcm9tICdldGhqcy1lbnMnO1xyXG4vLyBpbXBvcnQgSHR0cFByb3ZpZGVyIGZyb20gJ2V0aGpzLXByb3ZpZGVyLWh0dHAnO1xyXG5cclxuY2hyb21lLnJ1bnRpbWUub25JbnN0YWxsZWQuYWRkTGlzdGVuZXIoKCkgPT4ge1xyXG4gIGNocm9tZS5zdG9yYWdlLnN5bmMuc2V0KHtcclxuICAgIGZldGNoT25Ib3ZlcjogZmFsc2UsXHJcbiAgICByZXF1aXJlQ250cmw6IGZhbHNlXHJcbiAgfSk7XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gcGFyc2VWYWx1ZSh1c2Q6IHN0cmluZyB8IHVuZGVmaW5lZCB8IG51bGwpIHtcclxuICBpZiAoIXVzZCkgcmV0dXJuIDA7XHJcbiAgcmV0dXJuIE51bWJlcih1c2QucmVwbGFjZSgvXFwkfCwvZywgJycpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3V0U3RyPFQgPSBzdHJpbmc+KHN0cjogc3RyaW5nLCBzdGFydElkeDogbnVtYmVyLCBmcm9tOiBzdHJpbmcsIGZyb21FeHBhbmQ6IHN0cmluZyB8IG51bGwsIHRvOiBzdHJpbmcsIGRlZmF1bHRWYWx1ZTogVCwgcmVnZXg/OiBSZWdFeHAsIGZvcm1hdD86IChzOiBzdHJpbmcpID0+IFQpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IGlkeCA9IHN0ci5pbmRleE9mKGZyb20sIHN0YXJ0SWR4KTtcclxuICAgIGlmIChpZHggPT09IC0xKSB0aHJvdyAtMTtcclxuICAgIGlkeCArPSBmcm9tLmxlbmd0aDtcclxuICAgIGlmIChmcm9tRXhwYW5kKSB7XHJcbiAgICAgIGNvbnN0IGVuZElkeCA9IHN0ci5pbmRleE9mKGZyb21FeHBhbmQsIGlkeCk7XHJcbiAgICAgIGlmIChlbmRJZHggPT09IC0xKSB0aHJvdyAtMTtcclxuICAgICAgaWR4ID0gZW5kSWR4ICsgZnJvbUV4cGFuZC5sZW5ndGg7XHJcbiAgICB9XHJcbiAgICBjb25zdCB0b0lkeCA9IHN0ci5pbmRleE9mKHRvLCBpZHgpO1xyXG4gICAgY29uc3QgY3V0ID0gc3RyLnN1YnN0cmluZyhpZHgsIHRvSWR4KTtcclxuICAgIGNvbnN0IGNsZWFuZWQgPSByZWdleCA/IGN1dC5yZXBsYWNlKHJlZ2V4LCAnJykgOiBjdXQ7XHJcbiAgICBjb25zdCByZXN1bHQgPSBmb3JtYXQgPyBmb3JtYXQoY2xlYW5lZCkgOiBjbGVhbmVkO1xyXG4gICAgcmV0dXJuIFtyZXN1bHQgYXMgVCwgdG9JZHhdIGFzIGNvbnN0O1xyXG4gIH0gY2F0Y2gge1xyXG4gICAgcmV0dXJuIFtkZWZhdWx0VmFsdWUsIHN0YXJ0SWR4XSBhcyBjb25zdDtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IEVOU19NQVA6IHsgW2FkZHJlc3NPckVuczogc3RyaW5nXTogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB9ID0ge307XHJcbmFzeW5jIGZ1bmN0aW9uIHJlc29sdmVFbnNOYW1lKGlkOiBzdHJpbmcpIHtcclxuICBjb25zdCBjYWNoZWQgPSBFTlNfTUFQW2lkXTtcclxuICBpZiAoY2FjaGVkKSByZXR1cm4gYXdhaXQgUHJvbWlzZS5yZXNvbHZlKGNhY2hlZCk7XHJcbiAgY29uc3QgbG9vcHVwID0gbmV3IFByb21pc2U8c3RyaW5nIHwgbnVsbD4oYXN5bmMgciA9PiB7XHJcbiAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9ldGhlcnNjYW4uaW8vZW5zbG9va3VwLXNlYXJjaD9zZWFyY2g9JyArIGlkKTtcclxuICAgIGNvbnN0IGV0aHNjYW4gPSBhd2FpdCByZXMudGV4dCgpO1xyXG4gICAgY29uc3QgW2FkZHJlc3NdID0gY3V0U3RyPHN0cmluZyB8IG51bGw+KGV0aHNjYW4sIDEwMCwgYD0ndHh0RXRoZXJldW1BZGRyZXNzYCwgJz4nLCAnPC9zcGFuPicsIG51bGwpO1xyXG4gICAgaWYgKGFkZHJlc3MpIHtcclxuICAgICAgRU5TX01BUFthZGRyZXNzXSA9IGlkO1xyXG4gICAgICBFTlNfTUFQW2lkXSA9IGFkZHJlc3M7XHJcbiAgICAgIHIoYWRkcmVzcyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByKG51bGwpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIEVOU19NQVBbaWRdID0gbG9vcHVwO1xyXG4gIHJldHVybiBhd2FpdCBsb29wdXA7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gcmV2ZXJzZUVuc0xvb2t1cChhZGRyZXNzOiBzdHJpbmcpIHtcclxuICBjb25zdCBjYWNoZWQgPSBFTlNfTUFQW2FkZHJlc3NdO1xyXG4gIGlmIChjYWNoZWQpIHJldHVybiBhd2FpdCBQcm9taXNlLnJlc29sdmUoY2FjaGVkKTtcclxuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9ldGhlcnNjYW4uaW8vZW5zbG9va3VwLXNlYXJjaD9zZWFyY2g9JyArIGFkZHJlc3MpO1xyXG4gIGNvbnN0IGV0aHNjYW4gPSBhd2FpdCByZXMudGV4dCgpO1xyXG4gIGNvbnN0IFtlbnNdID0gY3V0U3RyPHN0cmluZyB8IG51bGw+KGV0aHNjYW4sIDEwMCwgYGFsdD0nRVRIJ2AsICc+JywgJzwvc3Bhbj4nLCBudWxsKTtcclxuICBpZiAoZW5zKSB7XHJcbiAgICBFTlNfTUFQW2Vuc10gPSBhZGRyZXNzO1xyXG4gICAgRU5TX01BUFthZGRyZXNzXSA9IGVucztcclxuICAgIHJldHVybiBlbnM7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgQ0FDSEU6IHsgW2FkZHJlc3NPckVuczogc3RyaW5nXTogdW5rbm93biB9ID0ge307XHJcbmFzeW5jIGZ1bmN0aW9uIGZldGNoQWRkcmVzcyhtZXNzYWdlOiBhbnksIHNlbmRSZXNwb25zZTogKHJlc3BvbnNlPzogYW55KSA9PiB2b2lkKSB7XHJcbiAgbGV0IGFkZHJlc3M6IHN0cmluZyB8IG51bGw7XHJcbiAgbGV0IGVuc05hbWU6IHN0cmluZyB8IG51bGw7XHJcbiAgbGV0IGFkZHJlc3NPckVucyA9IG1lc3NhZ2UuaWQudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgY29uc3QgY2FjaGVkID0gQ0FDSEVbYWRkcmVzc09yRW5zXTtcclxuICBpZiAoY2FjaGVkKSB7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IFByb21pc2UucmVzb2x2ZShjYWNoZWQpO1xyXG4gICAgc2VuZFJlc3BvbnNlKHJlc3BvbnNlKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGlmIChhZGRyZXNzT3JFbnMuc3RhcnRzV2l0aCgnMHgnKSkge1xyXG4gICAgYWRkcmVzcyA9IGFkZHJlc3NPckVucztcclxuICAgIGVuc05hbWUgPSBhd2FpdCBQcm9taXNlLnJlc29sdmUoRU5TX01BUFthZGRyZXNzIV0pO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCByZXNvbHZlZCA9IGF3YWl0IHJlc29sdmVFbnNOYW1lKGFkZHJlc3NPckVucyk7XHJcbiAgICBpZiAocmVzb2x2ZWQpIHtcclxuICAgICAgYWRkcmVzcyA9IHJlc29sdmVkO1xyXG4gICAgICBlbnNOYW1lID0gYWRkcmVzc09yRW5zO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VuZFJlc3BvbnNlKHtcclxuICAgICAgICB0eXBlOiAnQUREUkVTU19SRVNQT05TRScsXHJcbiAgICAgICAgYWRkcmVzczogYWRkcmVzcyEsXHJcbiAgICAgICAgZW5zOiBhZGRyZXNzT3JFbnMsXHJcbiAgICAgICAgZmFpbGVkOiB0cnVlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHIgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9ldGhlcnNjYW4uaW8vYWRkcmVzcy8nICsgYWRkcmVzcyEpO1xyXG4gICAgbGV0IGV0aHNjYW4gPSAoYXdhaXQgci50ZXh0KCkpO1xyXG5cclxuICAgIGxldCBbdGFnXSA9IGN1dFN0cihldGhzY2FuLCAwLCAnb2c6dGl0bGUnLCBgPVwiYCwgJ0FkZHJlc3MnLCAnJyk7XHJcbiAgICBpZiAodGFnKSB0YWcgPSB0YWcuc3Vic3RyaW5nKDAsIHRhZy5sZW5ndGggLSAzKTtcclxuXHJcbiAgICAvLyBjdXQgdGhlIGRvbSBzdHJpbmcgdG8gd2hhdCB3ZSBuZWVkXHJcbiAgICBldGhzY2FuID0gZXRoc2Nhbi5zdWJzdHJpbmcoZXRoc2Nhbi5pbmRleE9mKCdjb2wtbWQtOCcpIC0gMik7XHJcblxyXG4gICAgY29uc3QgW2V0aGVyLCBldGhJZHhdID0gY3V0U3RyKGV0aHNjYW4sIDAsICdjb2wtbWQtOCcsICc+JywgJzwvZGl2PicsIDAsIC9cXHNFdGhlcnw8Yj58PFxcL2I+fCwvZywgcGFyc2VWYWx1ZSk7XHJcbiAgICBjb25zdCBbZXRoZXJWYWx1ZSwgZXRoVklkeF0gPSBjdXRTdHIoZXRoc2NhbiwgZXRoSWR4LCAnY29sLW1kLTgnLCAnPicsICc8c3BhbicsIDAsIC9cXHN8XFwkfCwvZywgcGFyc2VWYWx1ZSk7XHJcblxyXG4gICAgY29uc3QgW2FsbFRva2Vuc1ZhbHVlLCBhdHZJZHhdID0gY3V0U3RyKGV0aHNjYW4sIGV0aFZJZHgsICdhdmFpbGFibGVCYWxhbmNlRHJvcGRvd24nLCAnPicsICc8c3BhbicsIDAsIC8+fFxcc3xcXCR8LC9nLCBwYXJzZVZhbHVlKTtcclxuXHJcbiAgICAvLyBjdXQgZXZlbiBtb3JlIGZvciB0b2tlbiBwYXJzaW5nXHJcbiAgICBldGhzY2FuID0gZXRoc2Nhbi5zdWJzdHJpbmcoYXR2SWR4KTtcclxuXHJcbiAgICBsZXQgbGFzdFRva2VuSWR4ID0gZXRoc2Nhbi5pbmRleE9mKCdsaXN0LWN1c3RvbS1FUkMyMCcpO1xyXG4gICAgbGV0IHRva2VuczogeyBzeW1ib2wsIGltZywgYW1vdW50LCB2YWx1ZSB9W10gPSBbXTtcclxuICAgIGxldCBtb3JlVG9rZW5zID0gbGFzdFRva2VuSWR4ID49IDA7XHJcbiAgICB3aGlsZSAobW9yZVRva2Vucykge1xyXG4gICAgICBjb25zdCBbaW1nLCBpbWdJZHhdID0gY3V0U3RyPHN0cmluZyB8IG51bGw+KGV0aHNjYW4sIGxhc3RUb2tlbklkeCwgJ2xpc3QtY3VzdG9tLUVSQzIwJywgYDxpbWcgc3JjPSdgLCBgJ2AsIG51bGwpO1xyXG4gICAgICBpZiAoaW1nID09PSBudWxsKSBicmVhaztcclxuICAgICAgY29uc3QgW2Ftb3VudCwgYW10SWR4XSA9IGN1dFN0cihldGhzY2FuLCBpbWdJZHgsIGBjbGFzcz0nbGlzdC1hbW91bnRgLCAnPicsICcgJywgMCwgdW5kZWZpbmVkLCBwYXJzZVZhbHVlKTtcclxuICAgICAgY29uc3QgW3N5bWJvbCwgc3ltSWR4XSA9IGN1dFN0cihldGhzY2FuLCBhbXRJZHgsICcgJywgbnVsbCwgJzwvc3Bhbj4nLCBudWxsKTtcclxuICAgICAgY29uc3QgW3ZhbHVlLCB2YWxJZHhdID0gY3V0U3RyKGV0aHNjYW4sIHN5bUlkeCwgJzxzcGFuJywgJz4nLCAnPC9zcGFuPicsIDAsIHVuZGVmaW5lZCwgcyA9PiBwYXJzZVZhbHVlKHMpIHx8IDApO1xyXG4gICAgICB0b2tlbnMucHVzaCh7IHN5bWJvbCwgaW1nLCBhbW91bnQsIHZhbHVlIH0pO1xyXG4gICAgICBsYXN0VG9rZW5JZHggPSB2YWxJZHg7XHJcbiAgICB9XHJcbiAgICBjb25zdCB0b2tlbkNvdW50ID0gdG9rZW5zLmxlbmd0aDtcclxuICAgIHRva2VucyA9IHRva2Vucy5zb3J0KChhLCBiKSA9PiBhLnZhbHVlIC0gYi52YWx1ZSkuc2xpY2UoLTMpLnJldmVyc2UoKTtcclxuICAgIHRva2Vucy5mb3JFYWNoKHQgPT4gdC5pbWcgPSAnaHR0cHM6Ly9ldGhlcnNjYW4uaW8nICsgdC5pbWcpO1xyXG4gICAgY29uc3QgdG9rZW5WYWx1ZSA9IHRva2Vucy5yZWR1Y2UoKHAsIGMpID0+IHAgKyBjLnZhbHVlLCAwKTtcclxuXHJcbiAgICBpZiAoIWVuc05hbWUhKSB7XHJcbiAgICAgIGNvbnN0IFtwYXJzZWRFbnNdID0gY3V0U3RyKGV0aHNjYW4sIE1hdGgubWF4KGxhc3RUb2tlbklkeCwgMSksIGBpZD0nZW5zTmFtZSdgLCAnPiAnLCAnPC9hPicsIG51bGwsIC9cXHMvZyk7XHJcbiAgICAgIGlmIChwYXJzZWRFbnMpIGVuc05hbWUgPSBwYXJzZWRFbnM7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzcG9uc2UgPSB7XHJcbiAgICAgIHR5cGU6ICdBRERSRVNTX1JFU1BPTlNFJyxcclxuICAgICAgYWRkcmVzczogYWRkcmVzcyEsXHJcbiAgICAgIGVuczogZW5zTmFtZSEsXHJcbiAgICAgIHRhZyxcclxuICAgICAgZXRoZXIsXHJcbiAgICAgIGV0aGVyVmFsdWUsXHJcbiAgICAgIHRva2VucyxcclxuICAgICAgdG9rZW5Db3VudCxcclxuICAgICAgdG9rZW5zVmFsdWU6IGFsbFRva2Vuc1ZhbHVlLFxyXG4gICAgICByZW1haW5pbmdUb2tlbnNWYWx1ZTogYWxsVG9rZW5zVmFsdWUgPiB0b2tlblZhbHVlID8gKGFsbFRva2Vuc1ZhbHVlIC0gdG9rZW5WYWx1ZSkgOiB1bmRlZmluZWRcclxuICAgIH07XHJcbiAgICBDQUNIRVthZGRyZXNzIV0gPSByZXNwb25zZTtcclxuICAgIENBQ0hFW2Vuc05hbWUhXSA9IHJlc3BvbnNlO1xyXG4gICAgc2VuZFJlc3BvbnNlKHJlc3BvbnNlKTtcclxuICB9IGNhdGNoIChleCkge1xyXG4gICAgY29uc29sZS5lcnJvcihleCk7XHJcbiAgICBzZW5kUmVzcG9uc2Uoe1xyXG4gICAgICB0eXBlOiAnQUREUkVTU19SRVNQT05TRScsXHJcbiAgICAgIGFkZHJlc3M6IGFkZHJlc3MhLFxyXG4gICAgICBlbnM6IGVuc05hbWUhLFxyXG4gICAgICBmYWlsZWQ6IHRydWVcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKChtZXNzYWdlLCBfLCBzZW5kUmVzcG9uc2UpID0+IHtcclxuICBzd2l0Y2ggKG1lc3NhZ2UudHlwZSkge1xyXG4gICAgY2FzZSAnRU5TX1JFU09MVkUnOlxyXG4gICAgICByZXNvbHZlRW5zTmFtZShtZXNzYWdlLmlkKS50aGVuKGFkZHJlc3MgPT4ge1xyXG4gICAgICAgIGlmIChhZGRyZXNzKSB7XHJcbiAgICAgICAgICBzZW5kUmVzcG9uc2UoeyB0eXBlOiAnRU5TX1JFU1BPTlNFJywgYWRkcmVzcyB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgc2VuZFJlc3BvbnNlKHsgdHlwZTogJ0VOU19SRVNQT05TRScsIGZhaWxlZDogdHJ1ZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIGNhc2UgJ0FERFJFU1NfUkVRVUVTVCc6XHJcbiAgICAgIGZldGNoQWRkcmVzcyhtZXNzYWdlLCBzZW5kUmVzcG9uc2UpO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgcmV0dXJuIGZhbHNlXHJcbn0pO1xyXG4iXSwKICAibWFwcGluZ3MiOiAiO0FBR0EsT0FBTyxRQUFRLFlBQVksWUFBWSxNQUFNO0FBQzNDLFNBQU8sUUFBUSxLQUFLLElBQUk7QUFBQSxJQUN0QixjQUFjO0FBQUEsSUFDZCxjQUFjO0FBQUEsRUFDaEIsQ0FBQztBQUNILENBQUM7QUFFRCxvQkFBb0IsS0FBZ0M7QUFDbEQsTUFBSSxDQUFDO0FBQUssV0FBTztBQUNqQixTQUFPLE9BQU8sSUFBSSxRQUFRLFNBQVMsRUFBRSxDQUFDO0FBQ3hDO0FBRUEsZ0JBQTRCLEtBQWEsVUFBa0IsTUFBYyxZQUEyQixJQUFZLGNBQWlCLE9BQWdCLFFBQTJCO0FBQzFLLE1BQUk7QUFDRixRQUFJLE1BQU0sSUFBSSxRQUFRLE1BQU0sUUFBUTtBQUNwQyxRQUFJLFFBQVE7QUFBSSxZQUFNO0FBQ3RCLFdBQU8sS0FBSztBQUNaLFFBQUksWUFBWTtBQUNkLFlBQU0sU0FBUyxJQUFJLFFBQVEsWUFBWSxHQUFHO0FBQzFDLFVBQUksV0FBVztBQUFJLGNBQU07QUFDekIsWUFBTSxTQUFTLFdBQVc7QUFBQSxJQUM1QjtBQUNBLFVBQU0sUUFBUSxJQUFJLFFBQVEsSUFB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
